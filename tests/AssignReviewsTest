<?php
session_start();
$_SESSION['user_id'] = "0";

require_once('config.php');
require_once('includes/handlers.php');

class AssignReviewsTest extends PHPUnit_Framework_TestCase {
	/**
	 * Causes a given student to create a submission for a given course.
	 * The bogus submission contains no file, and is purely an SQL entity.
	 */
	public function submitAssignment($studentid, $courseid) {
		
	}
	
	/**
	 * 
	 * 
	 * 
	 */
	public function testAssignReviews() {
		$_SESSION['course_id'] = "0";
		$handler = new PCRHandler();
		$course = $handler->getCourse();
		//Create an assignment (delete the old one first)
		$assignment = new Assignment(array("AssignmentID"=>"0"));
		$assignment->delete();
		
		$assignment = $handler->changeAssignment("0", "Test Assignment", "0", "0", "0", "0", "0", "0","0");
		
		$this->assertNotNull($assignment);
		$this->assertEquals($assignment->isValid(), true);
		
		//Fake file upload by populating $_FILES
		$_FILES["file"]["name"] = "test.zip";
		$_FILES["file"]["error"] = 0;
		$_FILES["file"]["tmp_name"] = "tests/test.zip";
		//Create a submission
		$subm = $handler->uploadArchive($assignment->getID());
		$this->assertNotNull($subm);
		$this->assertEquals($subm->isValid(), true);
		
		//Try uploading a repo submission with no host (should return null)
		$this->assertNull($handler->uploadRepo($assignment->getID(), "", "", ""));
		
		//Clean up the assignment 
		$assignment->delete();
	}
}